# 1. 资源

- 官网：https://chattts.com/zh
- Github (20.3k): https://github.com/2noise/ChatTTS
- modelscope模型下载网站：https://modelscope.cn/models/pzc163/chatTTS/summary

# 2. 使用心得

优点：
- 截至20240605，最好的中文TTS，声音细腻

缺点：
- 速度很慢，暂不支持流式 （H800 1秒音频，50秒才生成）
- 没有开源训练代码
- 笑声随机，不够稳定
- 安装使用坑很多，不够友好

没有原理介绍，从简单的介绍中得知，技术栈如下：
- bark, XTTSv2 and valle demostrate a remarkable TTS result by a autoregressive-style system.
- fish-speech reveals capability of GVQ as audio tokenizer for LLM modeling.
- vocos which is used as a pretrained vocoder.

# 3. 安装

## 3.1 模型下载

```bash
#安装ModelScope
pip install modelscope
```

```python
#SDK模型下载
from modelscope import snapshot_download
model_dir = snapshot_download('pzc163/chatTTS')
```

## 3.2 安装依赖

依赖

```text
ChatTTS
vocos
omegaconf~=2.3.0
tqdm
einops
vector_quantize_pytorch
IPython
transformers~=4.41.1
pynini==2.1.5
nemo_text_processing
WeTextProcessing
soundfile
torch~=2.1.0
torchaudio
```

## 3.3 使用

使用代码

```python
import ChatTTS
import soundfile


base_path = '/data/chatTTS'
chat = ChatTTS.Chat()
chat.load_models(source='local', local_path=base_path) # Set to True for better performance

texts = ["PUT YOUR TEXT HERE",]

wavs = chat.infer(texts)

soundfile.write("output1.wav", wavs[0][0], 24000)

```

```python
import torch
import ChatTTS
from IPython.display import Audio

# 初始化ChatTTS
chat = ChatTTS.Chat()
chat.load_models()

# 定义要转换为语音的文本
texts = ["你好，欢迎使用ChatTTS！"]

# 生成语音
wavs = chat.infer(texts, use_decoder=True)

# 播放生成的音频
Audio(wavs[0], rate=24_000, autoplay=True)
```

# 4. 错误

1. 问题：TypeError: Chat.load_models() got an unexpected keyword argument 'compile'
   
    解决：将代码仓中的ChatTTS目录考到和运行目录的同级目录下

2. 问题：local variable 'Normalizer' referenced before assignment 
    
   解决：
   - 方法1：
     - 参考：https://github.com/2noise/ChatTTS/issues/164
     - 安装pynini=2.1.5，nemo_text_processing，WeTextProcessing
   - 方法2 (不推荐)：
     - 参考：https://github.com/2noise/ChatTTS/issues/173
     - Normalizer 有些问题，可以在调用 infer 的时候把 do_text_normalization=False 加进去，跳过 normalizer 这一步，等后续修复吧

3. 问题：torchaudio 加载wav报错 Couldn‘t find appropriate backend to handle uri *** and format None

    解决：
    - 方法1：
      - 参考：https://github.com/2noise/ChatTTS/issues/181
      - 使用 soundfile 代替 torchaudio
    - 方法2（未测试）：可能是缺少音频库，通过 pip install pysoundfile来安装音频库

4. 问题：UserWarning: Plan failed with a cudnnException

    解决：
    - 参考：https://github.com/pytorch/pytorch/issues/121834
    - 暂时不管，初步看也没有影响，仅仅是一个警告
    - 从参考中得知，降低torch版本暂时就没有这个警告了 （暂未测试）